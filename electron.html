<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCC - AI Screen Orchestrator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --font-sans: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            --font-mono: 'SF Mono', 'Fira Code', monospace;
            
            --bg-primary: #18181b;
            --bg-surface: #1f1f23;
            --bg-elevated: #27272a;
            --bg-hover: #2e2e33;
            --bg-active: #3f3f46;
            
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-medium: rgba(255, 255, 255, 0.1);
            
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-tertiary: #71717a;
            --text-quaternary: #52525b;
            
            --accent: #a78bfa;
            --accent-soft: rgba(167, 139, 250, 0.1);
            --status-running: #f59e0b;
            --status-running-soft: rgba(245, 158, 11, 0.1);
            --status-done: #22c55e;
            --status-done-soft: rgba(34, 197, 94, 0.1);
            
            --claude: #a78bfa;
            --gpt: #10b981;
            --gemini: #3b82f6;
            --perplexity: #06b6d4;
            --midjourney: #f59e0b;
            --notion: #e11d48;
            --cursor: #f59e0b;
            
            --radius-sm: 6px;
            --radius-md: 8px;
        }
        
        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* ========== Header ========== */
        .header {
            height: 52px;
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            padding: 0 16px;
            padding-left: 80px;
            gap: 16px;
            -webkit-app-region: drag;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .logo-text {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 800;
            font-size: 13px;
            letter-spacing: 1px;
            color: white;
            background: linear-gradient(135deg, var(--accent), #818cf8);
            padding: 6px 10px;
            border-radius: 6px;
        }
        
        .header-divider {
            width: 1px;
            height: 20px;
            background: var(--border-subtle);
        }
        
        /* Status Queue */
        .status-queue {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            overflow-x: auto;
            padding: 4px 0;
            -webkit-app-region: no-drag;
        }
        
        .status-queue::-webkit-scrollbar { display: none; }
        
        .queue-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 10px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            font-size: 11px;
            white-space: nowrap;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .queue-item:hover { background: var(--bg-hover); }
        .queue-item.running {
            border-color: rgba(245, 158, 11, 0.3);
            background: var(--status-running-soft);
        }
        .queue-item.done {
            border-color: rgba(34, 197, 94, 0.3);
            background: var(--status-done-soft);
        }
        
        .queue-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--text-quaternary);
        }
        
        .queue-item.running .queue-dot {
            background: var(--status-running);
            animation: pulse 2s infinite;
        }
        
        .queue-item.done .queue-dot {
            background: var(--status-done);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .queue-name { color: var(--text-secondary); }
        .queue-item.running .queue-name { color: var(--text-primary); }
        
        .queue-status-text {
            font-size: 9px;
            color: var(--text-tertiary);
        }
        
        .queue-idle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .queue-idle-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--status-done);
        }
        
        /* Layout Tabs */
        .layout-tabs {
            display: flex;
            gap: 2px;
            background: var(--bg-elevated);
            padding: 3px;
            border-radius: var(--radius-sm);
            -webkit-app-region: no-drag;
        }
        
        .layout-tab {
            padding: 6px 8px;
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .layout-tab:hover { color: var(--text-secondary); }
        .layout-tab.active { background: var(--accent-soft); color: var(--accent); }
        
        .layout-tab svg { display: block; }
        
        .scan-btn {
            -webkit-app-region: no-drag;
            background: var(--accent);
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .scan-btn:hover { opacity: 0.9; }
        .scan-btn.scanning { opacity: 0.7; }
        
        .settings-btn {
            -webkit-app-region: no-drag;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
        
        /* ========== Main ========== */
        .main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        /* ========== Sidebar ========== */
        .sidebar {
            width: 240px;
            background: var(--bg-surface);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar.collapsed { width: 0; }
        
        .sidebar-content {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Purpose Dropdown */
        .purpose-dropdown {
            position: relative;
        }
        
        .purpose-trigger {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .purpose-trigger:hover { border-color: var(--border-medium); }
        
        .purpose-menu {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: 4px;
            display: none;
            z-index: 100;
        }
        
        .purpose-dropdown.open .purpose-menu { display: block; }
        
        .purpose-option {
            padding: 8px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .purpose-option:hover { background: var(--bg-hover); color: var(--text-primary); }
        .purpose-option.active { background: var(--accent-soft); color: var(--accent); }
        
        /* Section */
        .section-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-quaternary);
            margin-bottom: 8px;
        }
        
        /* Timeline */
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .scope-toggle {
            display: flex;
            gap: 4px;
        }
        
        .scope-btn {
            padding: 3px 8px;
            border: none;
            background: transparent;
            color: var(--text-quaternary);
            font-size: 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .scope-btn:hover { color: var(--text-tertiary); }
        .scope-btn.active { background: var(--bg-active); color: var(--text-primary); }
        
        .timeline-list {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .timeline-item:hover { background: var(--bg-hover); }
        .timeline-item.active { background: var(--accent-soft); }
        
        .timeline-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-quaternary);
        }
        
        .timeline-indicator.running { background: var(--status-running); }
        .timeline-indicator.done { background: var(--status-done); }
        
        .timeline-info { flex: 1; min-width: 0; }
        .timeline-name { font-size: 12px; font-weight: 500; }
        .timeline-task { font-size: 10px; color: var(--text-tertiary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .timeline-time { font-size: 10px; color: var(--text-quaternary); }
        
        /* Actions */
        .actions-section {
            padding-top: 12px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .action-primary {
            width: 100%;
            padding: 10px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-primary:hover { background: var(--bg-hover); }
        
        .action-primary kbd {
            background: var(--bg-active);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-family: var(--font-mono);
        }
        
        .shortcuts-list {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 10px;
            color: var(--text-quaternary);
        }
        
        .shortcut-item kbd {
            background: var(--bg-active);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: var(--font-mono);
            font-size: 9px;
            min-width: 45px;
            text-align: center;
        }
        
        /* ========== Workspace ========== */
        .workspace {
            flex: 1;
            display: grid;
            gap: 1px;
            background: var(--border-subtle);
            padding: 1px;
        }
        
        .workspace.layout-focus { grid-template-columns: 1fr; }
        .workspace.layout-split { grid-template-columns: 1fr 1fr; }
        .workspace.layout-grid { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .workspace.layout-stack { 
            grid-template-columns: 2fr 1fr; 
            grid-template-rows: 1fr 1fr; 
        }
        .workspace.layout-stack .window:first-child {
            grid-row: 1 / -1;
        }
        
        /* Window */
        .window {
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: box-shadow 0.15s ease;
        }
        
        .window.focused { box-shadow: inset 3px 0 0 var(--accent); }
        
        .window.dragging {
            opacity: 0.5;
        }
        
        .window.drag-over {
            box-shadow: inset 0 0 0 2px var(--accent);
        }
        
        .window-header {
            height: 36px;
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 8px;
        }
        
        .window-title {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .app-dot {
            width: 8px;
            height: 8px;
            border-radius: 2px;
        }
        
        .app-dot.claude { background: var(--claude); }
        .app-dot.gpt { background: var(--gpt); }
        .app-dot.gemini { background: var(--gemini); }
        .app-dot.perplexity { background: var(--perplexity); }
        .app-dot.midjourney { background: var(--midjourney); }
        .app-dot.notion { background: var(--notion); }
        .app-dot.cursor { background: var(--cursor); }
        .app-dot.custom { background: var(--app-custom-color, var(--accent)); }
        
        .window-name { font-size: 12px; font-weight: 500; }
        
        .window-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 10px;
            color: var(--text-quaternary);
        }
        
        .status-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
        }
        
        .status-dot.running { background: var(--status-running); animation: pulse 2s infinite; }
        .status-dot.done { background: var(--status-done); }
        .status-dot.idle { background: var(--text-quaternary); }
        
        .window-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        
        .window:hover .window-actions { opacity: 1; }
        
        .window-btn {
            background: transparent;
            border: 1px solid var(--border-subtle);
            color: var(--text-tertiary);
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .window-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
        
        /* Window Body */
        .window-body {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .window-body.clickable { cursor: pointer; }
        
        .window-screenshot {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: var(--bg-elevated);
        }
        
        .window-webview {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        
        .window-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: var(--text-tertiary);
        }
        
        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-subtle);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .window-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--bg-elevated);
        }
        
        .progress-bar {
            height: 100%;
            background: var(--status-running);
            transition: width 0.3s ease;
        }
        
        /* Screenshot overlay for desktop apps */
        .screenshot-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        
        .window-body.clickable:hover .screenshot-overlay { opacity: 1; }
        
        .overlay-btn {
            background: var(--accent);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            border: none;
            cursor: pointer;
        }
        
        .overlay-btn:hover { opacity: 0.9; }
        
        /* ========== Settings Panel ========== */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 200;
        }
        
        .settings-overlay.show { opacity: 1; visibility: visible; }
        
        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100%;
            background: var(--bg-surface);
            border-left: 1px solid var(--border-subtle);
            transition: right 0.25s ease;
            z-index: 201;
            display: flex;
            flex-direction: column;
        }
        
        .settings-panel.show { right: 0; }
        
        .settings-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-title { font-size: 14px; font-weight: 600; }
        
        .settings-close {
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
        }
        
        .settings-close:hover { color: var(--text-primary); }
        
        .settings-body {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }
        
        .settings-section {
            margin-bottom: 24px;
        }
        
        .settings-section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-quaternary);
            margin-bottom: 12px;
        }
        
        .lang-options {
            display: flex;
            gap: 8px;
        }
        
        .lang-btn {
            flex: 1;
            padding: 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
        }
        
        .lang-btn:hover { border-color: var(--border-medium); }
        .lang-btn.active { border-color: var(--accent); color: var(--accent); background: var(--accent-soft); }
        
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-subtle);
        }
        
        .setting-row:last-child { border-bottom: none; }
        
        .setting-label { 
            font-size: 13px; 
            color: var(--text-secondary);
        }
        
        .setting-row input { display: none; }
        
        .toggle {
            width: 44px;
            height: 24px;
            background: #52525b;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s ease;
            flex-shrink: 0;
        }
        
        .toggle::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }
        
        .setting-row input:checked + .toggle { 
            background: var(--accent); 
        }
        
        .setting-row input:checked + .toggle::before { 
            transform: translateX(20px); 
        }
        
        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 300;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .toast {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            padding: 10px 16px;
            border-radius: var(--radius-md);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slideIn 0.2s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Fold Toggle */
        .fold-toggle {
            position: absolute;
            left: 240px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 40px;
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-left: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-quaternary);
            font-size: 10px;
            z-index: 50;
        }
        
        .fold-toggle:hover { background: var(--bg-hover); color: var(--text-primary); }
        .sidebar.collapsed + .fold-toggle { left: 0; }
        
        /* Type badge */
        .type-badge {
            font-size: 9px;
            padding: 2px 5px;
            border-radius: 3px;
            background: var(--bg-active);
            color: var(--text-tertiary);
        }
        
        .type-badge.web { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .type-badge.desktop { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="logo">
                <span class="logo-text">DCC</span>
            </div>
            
            <div class="header-divider"></div>
            
            <div class="status-queue" id="statusQueue">
                <!-- Rendered dynamically -->
            </div>
            
            <div class="layout-tabs">
                <button class="layout-tab" data-layout="focus" title="Focus">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                        <rect x="1" y="1" width="12" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </button>
                <button class="layout-tab active" data-layout="split" title="Split">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                        <rect x="1" y="1" width="5" height="12" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="8" y="1" width="5" height="12" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </button>
                <button class="layout-tab" data-layout="grid" title="Grid">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                        <rect x="1" y="1" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="8" y="1" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="1" y="8" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="8" y="8" width="5" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </button>
                <button class="layout-tab" data-layout="stack" title="Stack">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                        <rect x="1" y="1" width="7" height="12" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="10" y="1" width="3" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="10" y="8" width="3" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </button>
            </div>
            
            <button class="scan-btn" id="scanBtn">AI 감지</button>
            <button class="settings-btn" id="settingsBtn">⚙</button>
        </header>
        
        <main class="main">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-content">
                    <!-- Purpose -->
                    <div class="purpose-dropdown" id="purposeDropdown">
                        <div class="purpose-trigger" id="purposeTrigger">
                            <span id="purposeLabel">전체</span>
                            <span>▾</span>
                        </div>
                        <div class="purpose-menu">
                            <div class="purpose-option active" data-purpose="all">전체</div>
                            <div class="purpose-option" data-purpose="research">리서치</div>
                            <div class="purpose-option" data-purpose="coding">코딩</div>
                            <div class="purpose-option" data-purpose="creative">크리에이티브</div>
                        </div>
                    </div>
                    
                    <!-- Timeline -->
                    <div class="timeline-section">
                        <div class="timeline-header">
                            <span class="section-title">타임라인</span>
                            <div class="scope-toggle">
                                <button class="scope-btn active" data-scope="all">All</button>
                            </div>
                        </div>
                        <div class="timeline-list" id="timelineList">
                            <!-- Rendered dynamically -->
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <div class="actions-section">
                        <button class="action-primary" id="transferBtn">
                            <span>결과 복사</span>
                            <kbd>⌘T</kbd>
                        </button>
                        <div class="shortcuts-list">
                            <div class="shortcut-item"><kbd>⌥1~4</kbd> <span>레이아웃</span></div>
                            <div class="shortcut-item"><kbd>⇧1~4</kbd> <span>목적 전환</span></div>
                        </div>
                    </div>
                </div>
            </aside>
            
            <button class="fold-toggle" id="foldToggle">‹</button>
            
            <div class="workspace layout-split" id="workspace">
                <!-- Windows rendered here -->
            </div>
        </main>
    </div>
    
    <!-- Settings Panel -->
    <div class="settings-overlay" id="settingsOverlay"></div>
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <span class="settings-title">설정</span>
            <button class="settings-close" id="settingsClose">×</button>
        </div>
        <div class="settings-body">
            <div class="settings-section">
                <div class="settings-section-title">언어</div>
                <div class="lang-options">
                    <button class="lang-btn active" data-lang="ko">한국어</button>
                    <button class="lang-btn" data-lang="en">English</button>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">동작</div>
                <div class="setting-row">
                    <span class="setting-label">완료 알림</span>
                    <label><input type="checkbox" id="notifyComplete" checked><span class="toggle"></span></label>
                </div>
                <div class="setting-row">
                    <span class="setting-label">자동 포커스</span>
                    <label><input type="checkbox" id="autoFocus"><span class="toggle"></span></label>
                </div>
                <div class="setting-row">
                    <span class="setting-label">진행률 표시</span>
                    <label><input type="checkbox" id="showProgress" checked><span class="toggle"></span></label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        const { ipcRenderer } = require('electron');
        
        // ========== 웹 AI URL 매핑 ==========
        const webAiUrls = {
            'claude': 'https://claude.ai',
            'claudechrome': 'https://claude.ai',
            'claudesafari': 'https://claude.ai',
            'chatgpt': 'https://chat.openai.com',
            'chatgptchrome': 'https://chat.openai.com',
            'gemini': 'https://gemini.google.com',
            'geminichrome': 'https://gemini.google.com',
            'perplexity': 'https://perplexity.ai',
            'perplexitychrome': 'https://perplexity.ai',
            'grok': 'https://grok.x.ai',
            'grokchrome': 'https://grok.x.ai',
            'poe': 'https://poe.com',
            'poechrome': 'https://poe.com',
            'midjourney': 'https://midjourney.com',
            'midjjourneychrome': 'https://midjourney.com'
        };
        
        // 데스크탑 앱 목록 (webview로 조작 불가)
        const desktopApps = ['cursor', 'notion', 'claudedesktop'];
        
        function isWebAI(key) {
            const keyLower = key.toLowerCase().replace(/[\s()]/g, '');
            return webAiUrls[keyLower] !== undefined && !desktopApps.some(d => keyLower.includes(d));
        }
        
        function getWebAIUrl(key) {
            const keyLower = key.toLowerCase().replace(/[\s()]/g, '');
            return webAiUrls[keyLower] || null;
        }
        
        // ========== i18n ==========
        const i18n = {
            ko: {
                all: '전체', research: '리서치', coding: '코딩', creative: '크리에이티브',
                running: '작업 중', done: '완료', idle: '대기', ready: '준비됨'
            },
            en: {
                all: 'All', research: 'Research', coding: 'Coding', creative: 'Creative',
                running: 'Running', done: 'Done', idle: 'Idle', ready: 'Ready'
            }
        };
        
        // ========== State ==========
        const state = {
            lang: 'ko',
            currentPurpose: 'all',
            currentLayout: 'split',
            focusedApp: null,
            lastCopied: null,
            settings: { notifyComplete: true, autoFocus: false, showProgress: true },
            apps: {},
            layouts: { focus: 1, split: 2, grid: 4, stack: 3 },
            timeline: []
        };
        
        // 앱별 목적 분류
        const appPurposeMap = {
            // 코딩/개발
            'cursor': 'coding', 'copilot': 'coding', 'antigravity': 'coding',
            'windsurf': 'coding', 'zed': 'coding', 'vscode': 'coding',
            'visualstudiocode': 'coding', 'androidstudio': 'coding', 'xcode': 'coding',
            'intellij': 'coding', 'webstorm': 'coding', 'pycharm': 'coding',
            // 리서치
            'claude': 'research', 'claudechrome': 'research', 'chatgpt': 'research', 
            'chatgptchrome': 'research', 'gemini': 'research', 'geminichrome': 'research',
            'perplexity': 'research', 'perplexitychrome': 'research', 'grok': 'research',
            'poe': 'research', 'poechrome': 'research',
            // 크리에이티브
            'midjourney': 'creative', 'dalle': 'creative', 'runway': 'creative',
            'notion': 'creative', 'obsidian': 'creative', 'craft': 'creative',
            'canva': 'creative', 'figma': 'creative', 'sketch': 'creative', 'framer': 'creative',
            'nanobanana': 'creative', 'pika': 'creative', 'sora': 'creative'
        };
        
        function t(key) { return i18n[state.lang][key] || key; }
        
        // ========== DOM 상태 분석 셀렉터 ==========
        const statusSelectors = {
            claude: {
                running: '[data-is-streaming="true"], .animate-pulse, [class*="loading"]',
                done: '.font-claude-message:last-child'
            },
            chatgpt: {
                running: 'button[aria-label="Stop generating"], .result-streaming, [class*="loading"]',
                done: '[data-message-author-role="assistant"]:last-child'
            },
            gemini: {
                running: '.loading-spinner, [class*="loading"], .thinking',
                done: '.model-response-text:last-child'
            },
            perplexity: {
                running: '.animate-pulse, [class*="loading"]',
                done: '.prose:last-child'
            }
        };
        
        // ========== Render Functions ==========
        function renderStatusQueue() {
            const container = document.getElementById('statusQueue');
            const monitoredApps = Object.entries(state.apps).filter(([_, app]) => app.monitored);
            const activeApps = monitoredApps.filter(([_, app]) => app.status === 'running' || app.status === 'done');
            
            if (monitoredApps.length === 0) {
                container.innerHTML = `
                    <div class="queue-idle">
                        <span style="color: var(--text-quaternary);">감지된 AI가 없습니다</span>
                    </div>
                `;
                return;
            }
            
            if (activeApps.length === 0) {
                container.innerHTML = `
                    <div class="queue-idle">
                        <div class="queue-idle-dot"></div>
                        <span>모든 AI가 요청을 기다리고 있습니다</span>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activeApps.map(([key, app]) => `
                <div class="queue-item ${app.status}" data-app="${key}">
                    <div class="queue-dot"></div>
                    <span class="queue-name">${app.name}</span>
                    <span class="queue-status-text">${t(app.status)}</span>
                </div>
            `).join('');
        }
        
        function renderTimeline() {
            const container = document.getElementById('timelineList');
            
            if (state.timeline.length === 0) {
                container.innerHTML = `
                    <div style="font-size: 11px; color: var(--text-quaternary); padding: 12px 8px; text-align: center;">
                        아직 진행 중인 작업이 없습니다
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.timeline.slice(0, 10).map(item => {
                const app = state.apps[item.appKey];
                if (!app) return '';
                return `
                    <div class="timeline-item ${state.focusedApp === item.appKey ? 'active' : ''}" data-app="${item.appKey}">
                        <div class="timeline-indicator ${item.status}"></div>
                        <div class="timeline-info">
                            <div class="timeline-name">${app.name}</div>
                            <div class="timeline-task">${item.task}</div>
                        </div>
                        <span class="timeline-time">${item.time}</span>
                    </div>
                `;
            }).join('');
        }
        
        function renderWorkspace() {
            const workspace = document.getElementById('workspace');
            workspace.className = `workspace layout-${state.currentLayout}`;
            
            const count = state.layouts[state.currentLayout];
            let monitoredApps = Object.entries(state.apps).filter(([_, app]) => app.monitored);
            
            // 목적별 필터링
            if (state.currentPurpose !== 'all') {
                monitoredApps = monitoredApps.filter(([key, _]) => {
                    const keyNormalized = key.toLowerCase().replace(/[\s()]/g, '');
                    const purpose = appPurposeMap[keyNormalized] || 'research';
                    return purpose === state.currentPurpose;
                });
            }
            
            const appsToShow = monitoredApps.slice(0, count);
            
            if (appsToShow.length === 0) {
                workspace.className = 'workspace layout-focus'; // 전체 화면으로 표시
                workspace.innerHTML = `
                    <div class="window">
                        <div class="window-body">
                            <div class="window-placeholder">
                                <div style="font-size: 17px; color: var(--text-secondary); line-height: 1.8; text-align: center;">
                                    AI 도구 실행 시 자동으로 감지해 노출됩니다.<br>
                                    <span style="color: var(--text-tertiary); font-size: 14px;">미노출 시 우상단 'AI 감지' 버튼을 클릭하세요.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            workspace.innerHTML = appsToShow.map(([key, app]) => {
                const isWeb = app.isWeb;
                const showProgress = state.settings.showProgress && app.status === 'running';
                
                let bodyContent;
                if (isWeb) {
                    // 웹 AI: webview로 직접 조작 (앱별 세션 분리)
                    const partitionName = key.replace(/[^a-z0-9]/gi, '');
                    bodyContent = `
                        <webview class="window-webview" data-app="${key}" 
                            src="${app.url}" 
                            partition="persist:${partitionName}"
                            allowpopups
                            webpreferences="contextIsolation=no"></webview>
                    `;
                } else {
                    // 데스크탑 앱: 스크린샷 + 클릭 전환
                    bodyContent = app.screenshot 
                        ? `<img class="window-screenshot" src="${app.screenshot}" alt="${app.name}">
                           <div class="screenshot-overlay">
                               <button class="overlay-btn" data-app="${key}">앱으로 전환 ↗</button>
                           </div>`
                        : `<div class="window-placeholder">
                               <div class="loading-spinner"></div>
                               <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 12px;">화면 캡처 중...</div>
                           </div>`;
                }
                
                return `
                    <div class="window ${state.focusedApp === key ? 'focused' : ''}" data-app="${key}">
                        <div class="window-header">
                            <div class="window-title">
                                <div class="app-dot" style="background: ${app.customColor || 'var(--accent)'}"></div>
                                <span class="window-name">${app.name}</span>
                                <span class="type-badge ${isWeb ? 'web' : 'desktop'}">${isWeb ? 'WEB' : 'APP'}</span>
                            </div>
                            <div class="window-status">
                                <div class="status-dot ${app.status}"></div>
                                <span>${t(app.status === 'running' ? 'running' : app.status === 'done' ? 'done' : 'ready')}</span>
                            </div>
                            <div class="window-actions">
                                ${!isWeb ? `<button class="window-btn open-btn" data-app="${key}" title="앱으로 전환">↗</button>` : ''}
                                <button class="window-btn reload-btn" data-app="${key}" title="새로고침">⟳</button>
                            </div>
                        </div>
                        <div class="window-body ${!isWeb ? 'clickable' : ''}" data-app="${key}">
                            ${bodyContent}
                            ${showProgress ? `<div class="window-progress"><div class="progress-bar" style="width:50%"></div></div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // 이벤트 바인딩
            bindWorkspaceEvents();
        }
        
        function bindWorkspaceEvents() {
            const windows = document.querySelectorAll('.window');
            
            // 데스크탑 앱 클릭 → 앱 활성화
            document.querySelectorAll('.screenshot-overlay .overlay-btn, .open-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    const key = btn.dataset.app;
                    const app = state.apps[key];
                    if (app) {
                        await ipcRenderer.invoke('activate-app', app.name);
                        toast('↗', `${app.name} 활성화`);
                    }
                });
            });
            
            // 데스크탑 앱 body 클릭 → 앱 활성화
            document.querySelectorAll('.window-body.clickable').forEach(body => {
                body.addEventListener('click', async (e) => {
                    if (e.target.closest('.overlay-btn')) return;
                    const key = body.dataset.app;
                    const app = state.apps[key];
                    if (app && !app.isWeb) {
                        await ipcRenderer.invoke('activate-app', app.name);
                        toast('↗', `${app.name} 활성화`);
                    }
                });
            });
            
            // 새로고침 버튼
            document.querySelectorAll('.reload-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const key = btn.dataset.app;
                    const app = state.apps[key];
                    if (app?.isWeb) {
                        const webview = document.querySelector(`webview[data-app="${key}"]`);
                        if (webview) webview.reload();
                    } else {
                        captureDesktopApps();
                    }
                    toast('⟳', '새로고침');
                });
            });
            
            // 창 포커스 (헤더 클릭)
            document.querySelectorAll('.window-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    if (e.target.closest('.window-actions')) return;
                    const win = header.closest('.window');
                    state.focusedApp = win.dataset.app;
                    windows.forEach(w => 
                        w.classList.toggle('focused', w.dataset.app === state.focusedApp));
                });
            });
            
            // 드래그 앤 드롭
            windows.forEach(win => {
                win.setAttribute('draggable', 'true');
                
                win.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', win.dataset.app);
                    win.classList.add('dragging');
                });
                
                win.addEventListener('dragend', () => {
                    win.classList.remove('dragging');
                    windows.forEach(w => w.classList.remove('drag-over'));
                });
                
                win.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (!win.classList.contains('dragging')) {
                        win.classList.add('drag-over');
                    }
                });
                
                win.addEventListener('dragleave', () => {
                    win.classList.remove('drag-over');
                });
                
                win.addEventListener('drop', (e) => {
                    e.preventDefault();
                    win.classList.remove('drag-over');
                    
                    const draggedApp = e.dataTransfer.getData('text/plain');
                    const targetApp = win.dataset.app;
                    
                    if (draggedApp && targetApp && draggedApp !== targetApp) {
                        // 앱 순서 교환
                        swapApps(draggedApp, targetApp);
                    }
                });
            });
            
            // Webview 상태 감지 시작
            startWebviewStatusDetection();
        }
        
        function swapApps(app1Key, app2Key) {
            const keys = Object.keys(state.apps);
            const idx1 = keys.indexOf(app1Key);
            const idx2 = keys.indexOf(app2Key);
            
            if (idx1 === -1 || idx2 === -1) return;
            
            // 순서 재배열
            const newApps = {};
            keys.forEach((key, i) => {
                if (i === idx1) {
                    newApps[app2Key] = state.apps[app2Key];
                } else if (i === idx2) {
                    newApps[app1Key] = state.apps[app1Key];
                } else {
                    newApps[key] = state.apps[key];
                }
            });
            
            state.apps = newApps;
            renderWorkspace();
            toast('↔', '위치 변경됨');
        }
        
        function render() {
            renderStatusQueue();
            renderTimeline();
            renderWorkspace();
        }
        
        // ========== Webview 상태 감지 ==========
        function startWebviewStatusDetection() {
            document.querySelectorAll('webview').forEach(webview => {
                const appKey = webview.dataset.app;
                
                webview.addEventListener('did-finish-load', () => {
                    // 로드 완료 후 상태 감지 시작
                    detectWebviewStatus(webview, appKey);
                });
                
                webview.addEventListener('dom-ready', () => {
                    // 주기적 상태 감지
                    setInterval(() => detectWebviewStatus(webview, appKey), 2000);
                });
            });
        }
        
        async function detectWebviewStatus(webview, appKey) {
            const keyLower = appKey.toLowerCase().replace(/[\s()]/g, '');
            let selectors = null;
            
            // 서비스별 셀렉터 찾기
            for (const [service, sel] of Object.entries(statusSelectors)) {
                if (keyLower.includes(service)) {
                    selectors = sel;
                    break;
                }
            }
            
            if (!selectors) return;
            
            try {
                const script = `
                    (function() {
                        const running = document.querySelector('${selectors.running}');
                        if (running) return 'running';
                        return 'idle';
                    })()
                `;
                
                const status = await webview.executeJavaScript(script);
                const app = state.apps[appKey];
                
                if (app && app.status !== status) {
                    const prevStatus = app.status;
                    app.status = status;
                    
                    // 상태 변경 시 타임라인 업데이트
                    if (status === 'running') {
                        addToTimeline(appKey, '작업 시작', 'running');
                    } else if (prevStatus === 'running' && status === 'idle') {
                        app.status = 'done';
                        addToTimeline(appKey, '작업 완료', 'done');
                        
                        if (state.settings.notifyComplete) {
                            toast('✓', `${app.name} 작업 완료`);
                            // 시스템 알림
                            new Notification('DCC', { body: `${app.name} 작업이 완료되었습니다.` });
                        }
                        
                        // 3초 후 idle로 변경
                        setTimeout(() => {
                            app.status = 'idle';
                            renderStatusQueue();
                        }, 3000);
                    }
                    
                    renderStatusQueue();
                }
            } catch (e) {
                // 감지 실패 무시
            }
        }
        
        function addToTimeline(appKey, task, status) {
            const now = new Date();
            const time = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            state.timeline.unshift({
                appKey,
                task,
                status,
                time,
                timestamp: now.getTime()
            });
            
            // 최대 50개 유지
            if (state.timeline.length > 50) {
                state.timeline = state.timeline.slice(0, 50);
            }
            
            renderTimeline();
        }
        
        // ========== 데스크탑 앱 스크린샷 ==========
        let captureInterval = null;
        
        async function captureDesktopApps() {
            const desktopAppsToCapture = Object.entries(state.apps)
                .filter(([_, app]) => app.monitored && !app.isWeb);
            
            if (desktopAppsToCapture.length === 0) return;
            
            const appInfos = desktopAppsToCapture.map(([_, app]) => ({
                name: app.name,
                browser: app.browser || null
            }));
            
            const results = await ipcRenderer.invoke('capture-all-windows', appInfos);
            
            desktopAppsToCapture.forEach(([key, app]) => {
                if (results[app.name]) {
                    app.screenshot = results[app.name];
                    const img = document.querySelector(`.window[data-app="${key}"] .window-screenshot`);
                    if (img) {
                        img.src = results[app.name];
                    }
                }
            });
        }
        
        function startDesktopCapture() {
            if (captureInterval) clearInterval(captureInterval);
            captureDesktopApps();
            captureInterval = setInterval(captureDesktopApps, 3000);
        }
        
        // ========== 알림 감지 (데스크탑 앱용) ==========
        async function checkNotifications() {
            try {
                const notifications = await ipcRenderer.invoke('get-recent-notifications');
                
                notifications.forEach(notif => {
                    // 앱 이름으로 매칭
                    const matchingApp = Object.entries(state.apps).find(([key, app]) => {
                        const appName = app.name.toLowerCase();
                        const notifApp = (notif.app || '').toLowerCase();
                        return notifApp.includes(appName) || appName.includes(notifApp);
                    });
                    
                    if (matchingApp) {
                        const [key, app] = matchingApp;
                        
                        // 알림 내용에 따라 상태 업데이트
                        const body = (notif.body || '').toLowerCase();
                        if (body.includes('완료') || body.includes('complete') || body.includes('done') || body.includes('finished')) {
                            app.status = 'done';
                            addToTimeline(key, notif.body || '작업 완료', 'done');
                            
                            if (state.settings.notifyComplete) {
                                toast('✓', `${app.name}: ${notif.body || '작업 완료'}`);
                            }
                            
                            setTimeout(() => {
                                app.status = 'idle';
                                renderStatusQueue();
                            }, 3000);
                        }
                    }
                });
            } catch (e) {
                // 알림 감지 실패 무시
            }
        }
        
        // ========== Event Handlers ==========
        // Purpose dropdown
        const purposeDropdown = document.getElementById('purposeDropdown');
        const purposeTrigger = document.getElementById('purposeTrigger');
        
        purposeTrigger.addEventListener('click', () => purposeDropdown.classList.toggle('open'));
        
        document.querySelectorAll('.purpose-option').forEach(opt => {
            opt.addEventListener('click', () => {
                state.currentPurpose = opt.dataset.purpose;
                document.querySelectorAll('.purpose-option').forEach(o => o.classList.remove('active'));
                opt.classList.add('active');
                document.getElementById('purposeLabel').textContent = opt.textContent;
                purposeDropdown.classList.remove('open');
                render();
                saveSettings();
            });
        });
        
        document.addEventListener('click', e => {
            if (!purposeDropdown.contains(e.target)) purposeDropdown.classList.remove('open');
        });
        
        // Layout tabs
        document.querySelectorAll('.layout-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.layout-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                state.currentLayout = tab.dataset.layout;
                renderWorkspace();
                saveSettings();
            });
        });
        
        // Fold toggle
        const sidebar = document.getElementById('sidebar');
        const foldToggle = document.getElementById('foldToggle');
        
        foldToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            foldToggle.textContent = sidebar.classList.contains('collapsed') ? '›' : '‹';
        });
        
        // Settings
        document.getElementById('settingsBtn').addEventListener('click', () => {
            document.getElementById('settingsPanel').classList.add('show');
            document.getElementById('settingsOverlay').classList.add('show');
        });
        
        document.getElementById('settingsClose').addEventListener('click', closeSettings);
        document.getElementById('settingsOverlay').addEventListener('click', closeSettings);
        
        function closeSettings() {
            document.getElementById('settingsPanel').classList.remove('show');
            document.getElementById('settingsOverlay').classList.remove('show');
        }
        
        // Language
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.lang = btn.dataset.lang;
                render();
                saveSettings();
            });
        });
        
        // Settings toggles
        ['notifyComplete', 'autoFocus', 'showProgress'].forEach(id => {
            document.getElementById(id).addEventListener('change', e => {
                state.settings[id] = e.target.checked;
                if (id === 'showProgress') renderWorkspace();
                saveSettings();
            });
        });
        
        // Transfer - AI 결과 복사
        document.getElementById('transferBtn').addEventListener('click', async () => {
            if (!state.focusedApp) {
                toast('⚠', '먼저 창을 선택하세요');
                return;
            }
            
            const app = state.apps[state.focusedApp];
            if (!app?.isWeb) {
                toast('⚠', '웹 AI만 결과 복사가 가능합니다');
                return;
            }
            
            const webview = document.querySelector(`webview[data-app="${state.focusedApp}"]`);
            if (!webview) return;
            
            const selectors = {
                claude: '.font-claude-message:last-child, [class*="prose"]:last-child',
                chatgpt: '[data-message-author-role="assistant"]:last-child .markdown',
                gemini: '.model-response-text:last-child',
                perplexity: '.prose:last-child'
            };
            
            const keyLower = state.focusedApp.toLowerCase();
            let selector = 'body';
            for (const [service, sel] of Object.entries(selectors)) {
                if (keyLower.includes(service)) {
                    selector = sel;
                    break;
                }
            }
            
            try {
                const script = `
                    (function() {
                        const el = document.querySelector('${selector}');
                        return el ? el.innerText : '';
                    })()
                `;
                const result = await webview.executeJavaScript(script);
                
                if (result && result.trim()) {
                    await navigator.clipboard.writeText(result.trim());
                    state.lastCopied = { from: state.focusedApp, content: result.trim() };
                    toast('📋', `${app.name} 결과 복사됨`);
                } else {
                    toast('⚠', '복사할 결과가 없습니다');
                }
            } catch (e) {
                toast('⚠', '결과를 가져올 수 없습니다');
            }
        });
        
        // 단축키
        document.addEventListener('keydown', (e) => {
            // ⌘T: 결과 복사
            if ((e.metaKey) && !e.ctrlKey && !e.altKey && e.key === 't') {
                e.preventDefault();
                document.getElementById('transferBtn').click();
                return;
            }
            
            // ⌥1~4: 레이아웃 전환 (Option + 숫자)
            if (e.altKey && !e.metaKey && !e.ctrlKey && ['1', '2', '3', '4'].includes(e.key)) {
                e.preventDefault();
                const layouts = ['focus', 'split', 'grid', 'stack'];
                const idx = parseInt(e.key) - 1;
                if (layouts[idx]) {
                    state.currentLayout = layouts[idx];
                    document.querySelectorAll('.layout-tab').forEach(t => 
                        t.classList.toggle('active', t.dataset.layout === state.currentLayout));
                    renderWorkspace();
                    saveSettings();
                    toast('⊞', `레이아웃: ${layouts[idx]}`);
                }
                return;
            }
            
            // ⇧1~4: 목적 전환 (Shift + 숫자)
            if (e.shiftKey && !e.metaKey && !e.ctrlKey && !e.altKey) {
                // Shift + 숫자는 특수문자가 됨: ! @ # $
                const keyMap = { '!': 0, '@': 1, '#': 2, '$': 3 };
                const idx = keyMap[e.key];
                if (idx !== undefined) {
                    e.preventDefault();
                    const purposes = ['all', 'research', 'coding', 'creative'];
                    const purposeNames = ['전체', '리서치', '코딩', '크리에이티브'];
                    state.currentPurpose = purposes[idx];
                    document.querySelectorAll('.purpose-option').forEach(o => {
                        const active = o.dataset.purpose === state.currentPurpose;
                        o.classList.toggle('active', active);
                        if (active) document.getElementById('purposeLabel').textContent = o.textContent;
                    });
                    render();
                    saveSettings();
                    toast('◎', `목적: ${purposeNames[idx]}`);
                }
                return;
            }
        });
        
        // ========== Toast ==========
        function toast(icon, message) {
            const container = document.getElementById('toastContainer');
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerHTML = `<span>${icon}</span><span>${message}</span>`;
            container.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }
        
        // ========== Persistence ==========
        function saveSettings() {
            localStorage.setItem('dcc', JSON.stringify({
                lang: state.lang,
                currentPurpose: state.currentPurpose,
                currentLayout: state.currentLayout,
                settings: state.settings
            }));
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('dcc');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.lang) state.lang = data.lang;
                    if (data.currentPurpose) state.currentPurpose = data.currentPurpose;
                    if (data.currentLayout) state.currentLayout = data.currentLayout;
                    Object.assign(state.settings, data.settings);
                    
                    // Apply to UI
                    document.querySelectorAll('.lang-btn').forEach(b => 
                        b.classList.toggle('active', b.dataset.lang === state.lang));
                    document.querySelectorAll('.layout-tab').forEach(t => 
                        t.classList.toggle('active', t.dataset.layout === state.currentLayout));
                    document.querySelectorAll('.purpose-option').forEach(o => {
                        const active = o.dataset.purpose === state.currentPurpose;
                        o.classList.toggle('active', active);
                        if (active) document.getElementById('purposeLabel').textContent = o.textContent;
                    });
                    ['notifyComplete', 'autoFocus', 'showProgress'].forEach(id => {
                        document.getElementById(id).checked = state.settings[id];
                    });
                } catch (e) {}
            }
        }
        
        // ========== AI 감지 ==========
        document.getElementById('scanBtn').addEventListener('click', async () => {
            const scanBtn = document.getElementById('scanBtn');
            scanBtn.classList.add('scanning');
            scanBtn.textContent = '감지 중...';
            
            try {
                await autoDetectAI();
            } catch (e) {
                console.error(e);
                toast('⚠', '감지 실패');
            }
            
            scanBtn.classList.remove('scanning');
            scanBtn.textContent = 'AI 감지';
        });
        
        async function autoDetectAI() {
            const runningApps = await ipcRenderer.invoke('get-running-ai-apps');
            
            // 디버깅: 모든 실행 중인 앱 출력
            const debugInfo = runningApps.find(a => a.name === '__DEBUG_ALL_APPS__');
            if (debugInfo) {
                console.log('=== ALL RUNNING APPS ===');
                console.log(debugInfo.allApps);
            }
            
            // 디버깅: 모든 창 목록 출력
            const windowList = await ipcRenderer.invoke('get-window-list');
            console.log('=== ALL WINDOWS ===');
            console.log(windowList.map(w => w.name));
            
            // 필터링된 앱만 처리
            const filteredApps = runningApps.filter(a => a.name !== '__DEBUG_ALL_APPS__');
            console.log('Detected AI apps:', filteredApps.map(a => a.name));
            
            let addedCount = 0;
            
            filteredApps.forEach(appInfo => {
                const name = appInfo.name;
                const key = name.toLowerCase().replace(/[\s()]/g, '');
                
                if (state.apps[key]?.monitored) return;
                
                // 색상 결정 (앱별)
                const colorMap = {
                    'chatgpt': '#10b981', 'gemini': '#3b82f6', 'claude': '#a78bfa',
                    'perplexity': '#06b6d4', 'grok': '#ef4444', 'poe': '#8b5cf6',
                    'cursor': '#f59e0b', 'antigravity': '#ec4899', 'windsurf': '#06b6d4',
                    'zed': '#f59e0b', 'vscode': '#3b82f6', 'xcode': '#3b82f6',
                    'notion': '#e11d48', 'obsidian': '#8b5cf6', 'figma': '#f59e0b',
                    'midjourney': '#f59e0b', 'runway': '#06b6d4'
                };
                let color = '#a78bfa';
                for (const [appName, appColor] of Object.entries(colorMap)) {
                    if (key.includes(appName)) {
                        color = appColor;
                        break;
                    }
                }
                
                // 웹 AI 여부 판단
                const isWeb = appInfo.type === 'browser' || isWebAI(key);
                const url = isWeb ? (appInfo.url || getWebAIUrl(key)) : null;
                
                state.apps[key] = {
                    name,
                    url,
                    customColor: color,
                    status: 'idle',
                    monitored: true,
                    screenshot: null,
                    isWeb,
                    browser: appInfo.browser
                };
                
                addedCount++;
            });
            
            if (addedCount > 0) {
                toast('✓', `${addedCount}개 AI 추가됨`);
                render();
                startDesktopCapture();
            } else {
                toast('ℹ', '새로운 AI가 없습니다');
            }
        }
        
        // ========== Init ==========
        loadSettings();
        render();
        
        // 알림 권한 요청
        if (Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // 자동 감지 시작
        autoDetectAI();
        setInterval(autoDetectAI, 10000);
        
        // 알림 감지 (데스크탑 앱용)
        setInterval(checkNotifications, 5000);
    </script>
</body>
</html>
